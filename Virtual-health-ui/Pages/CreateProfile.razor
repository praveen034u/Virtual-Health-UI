@page "/create-profile"
@using System.ComponentModel.DataAnnotations
@inject IJSRuntime JS

<h3 class="mt-4 mb-4 text-primary">Create Patient Profile</h3>

<EditForm Model="@patientProfile" OnValidSubmit="@HandleValidSubmit">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="accordion" id="profileAccordion">
        <!-- Personal Details -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingPersonal">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePersonal" aria-expanded="true" aria-controls="collapsePersonal">
                    1. Personal Details
                </button>
            </h2>
            <div id="collapsePersonal" class="accordion-collapse collapse show" aria-labelledby="headingPersonal" data-bs-parent="#profileAccordion">
                <div class="accordion-body">
                    <div class="form-group">
                        <label>Full Name <span class="text-danger">*</span></label>
                        <InputText @bind-Value="patientProfile.FullName" class="form-control" placeholder="John Doe" />
                    </div>
                    <div class="form-group">
                        <label>Date of Birth <span class="text-danger">*</span></label>
                        <InputDate @bind-Value="patientProfile.DateOfBirth" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label>Address</label>
                        <InputText @bind-Value="patientProfile.Address" class="form-control" placeholder="123 Main St, Springfield" />
                    </div>
                    <div class="form-group">
                        <label>Phone Number</label>
                        <InputText @bind-Value="patientProfile.PhoneNumber" class="form-control" />
                    </div>
                    <div class="form-group">
                        <label>Emergency Contact Info</label>
                        <InputText @bind-Value="patientProfile.EmergencyContact" class="form-control" placeholder="Jane Doe - (123) 456-7890" />
                    </div>
                </div>
            </div>
        </div>

        <!-- Provider -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingProvider">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseProvider">
                    2. Primary Care Provider
                </button>
            </h2>
            <div id="collapseProvider" class="accordion-collapse collapse">
                <div class="accordion-body">
                    <InputText @bind-Value="patientProfile.ProviderName" class="form-control mb-2" placeholder="Provider Name" />
                    <InputText @bind-Value="patientProfile.ProviderEmail" class="form-control mb-2" placeholder="Provider Email" />
                    <InputText @bind-Value="patientProfile.ProviderPhone" class="form-control mb-2" placeholder="Provider Phone" />
                </div>
            </div>
        </div>

        <!-- Insurance -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingInsurance">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInsurance">
                    3. Insurance Information
                </button>
            </h2>
            <div id="collapseInsurance" class="accordion-collapse collapse">
                <div class="accordion-body">
                    <InputText @bind-Value="patientProfile.InsuranceProvider" class="form-control mb-2" placeholder="Insurance Provider" />
                    <InputText @bind-Value="patientProfile.PolicyNumber" class="form-control mb-2" placeholder="Policy Number" />
                </div>
            </div>
        </div>

        <!-- Medical Details -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingMedical">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMedical">
                    4–8. Medical, Family History, Medications, Visit Reason, Lifestyle
                </button>
            </h2>
            <div id="collapseMedical" class="accordion-collapse collapse">
                <div class="accordion-body">
                    <label>4. Medical History</label>
                    <InputTextArea @bind-Value="patientProfile.MedicalHistory" class="form-control mb-3" rows="3" placeholder="Past illnesses, allergies, surgeries..." />

                    <label>5. Family Medical History</label>
                    <InputTextArea @bind-Value="patientProfile.FamilyMedicalHistory" class="form-control mb-3" rows="2" placeholder="e.g., Diabetes, Heart Disease" />

                    <label>6. Current Medications</label>
                    <InputTextArea @bind-Value="patientProfile.CurrentMedications" class="form-control mb-3" rows="2" placeholder="e.g., Aspirin 100mg daily, Vitamin D" />

                    <label>7. Reason for Visit</label>
                    <InputTextArea @bind-Value="patientProfile.ReasonForVisit" class="form-control mb-3" rows="2" placeholder="e.g., chest pain, regular checkup" />

                    <label>8. Lifestyle Information</label>
                    <InputTextArea @bind-Value="patientProfile.Lifestyle" class="form-control mb-3" rows="3" placeholder="e.g., Smoker, Vegetarian, Exercise 3x/week" />
                </div>
            </div>
        </div>

        <!-- Consent -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingConsent">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseConsent">
                    9. Consent Forms
                </button>
            </h2>
            <div id="collapseConsent" class="accordion-collapse collapse">
                <div class="accordion-body">
                    <div class="form-check">
                        <InputCheckbox @bind-Value="patientProfile.ConsentTreatment" class="form-check-input" />
                        <label class="form-check-label">I consent to treatment</label>
                    </div>
                    <div class="form-check">
                        <InputCheckbox @bind-Value="patientProfile.ConsentPrivacy" class="form-check-input" />
                        <label class="form-check-label">I agree to the privacy policy</label>
                    </div>
                    <div class="form-check">
                        <InputCheckbox @bind-Value="patientProfile.ConsentBilling" class="form-check-input" />
                        <label class="form-check-label">I agree to the billing terms</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vitals -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingVitals">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseVitals">
                    10. Vitals: Blood Pressure & Heart Rate
                </button>
            </h2>
            <div id="collapseVitals" class="accordion-collapse collapse">
                <div class="accordion-body">
                    <div class="form-group">
                        <label>Blood Pressure (mm Hg) <small>(e.g., 120/80)</small></label>
                        <InputText @bind-Value="patientProfile.BloodPressure" class="form-control" />
                    </div>
                    <div class="form-group mt-2">
                        <label>Resting Heart Rate (bpm)</label>
                        <InputNumber @bind-Value="patientProfile.HeartRate" class="form-control" />
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex flex-column flex-md-row mt-4">
        <button type="submit" class="btn btn-primary mb-2 mb-md-0 me-md-2">Submit</button>
        <button type="button" class="btn btn-secondary" @onclick="GenerateSummary">Download Summary</button>
    </div>
</EditForm>

@code {
    private PatientProfileModel patientProfile = new();

    private async Task HandleValidSubmit()
    {
        await JS.InvokeVoidAsync("alert", "Profile submitted successfully!");
    }

    private async Task GenerateSummary()
    {
        var summary = $"Patient Profile Summary\n\nName: {patientProfile.FullName}\nDOB: {patientProfile.DateOfBirth:d}\nAddress: {patientProfile.Address}\nPhone: {patientProfile.PhoneNumber}\nEmergency Contact: {patientProfile.EmergencyContact}\n\nProvider: {patientProfile.ProviderName}, {patientProfile.ProviderEmail}, {patientProfile.ProviderPhone}\nInsurance: {patientProfile.InsuranceProvider}, Policy #: {patientProfile.PolicyNumber}\n\nMedical History: {patientProfile.MedicalHistory}\nFamily History: {patientProfile.FamilyMedicalHistory}\nMedications: {patientProfile.CurrentMedications}\nReason for Visit: {patientProfile.ReasonForVisit}\nLifestyle: {patientProfile.Lifestyle}\n\nBP: {patientProfile.BloodPressure}\nHR: {patientProfile.HeartRate} bpm\n\nConsents:\n- Treatment: {(patientProfile.ConsentTreatment ? "Yes" : "No")}\n- Privacy: {(patientProfile.ConsentPrivacy ? "Yes" : "No")}\n- Billing: {(patientProfile.ConsentBilling ? "Yes" : "No")}";

        await JS.InvokeVoidAsync("navigator.clipboard.writeText", summary);
        await JS.InvokeVoidAsync("alert", "Summary copied to clipboard. Paste in Word or save as PDF.");
    }

    public class PatientProfileModel
    {
        [Required] public string FullName { get; set; }
        [Required] public DateTime DateOfBirth { get; set; }
        public string Address { get; set; }
        public string PhoneNumber { get; set; }
        public string EmergencyContact { get; set; }

        public string ProviderName { get; set; }
        public string ProviderEmail { get; set; }
        public string ProviderPhone { get; set; }

        public string InsuranceProvider { get; set; }
        public string PolicyNumber { get; set; }

        public string MedicalHistory { get; set; }
        public string FamilyMedicalHistory { get; set; }
        public string CurrentMedications { get; set; }
        public string ReasonForVisit { get; set; }
        public string Lifestyle { get; set; }

        public string BloodPressure { get; set; }
        public int? HeartRate { get; set; }

        public bool ConsentTreatment { get; set; }
        public bool ConsentPrivacy { get; set; }
        public bool ConsentBilling { get; set; }
    }
}
